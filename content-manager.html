<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Content Manager - CinemaVault</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .content-manager {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .manager-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .manager-header h1 {
            color: var(--color-primary);
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .manager-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            margin-bottom: 3rem;
        }

        .manager-section {
            background: var(--color-surface);
            padding: 2rem;
            border-radius: 12px;
            border: 1px solid var(--color-border);
        }

        .section-title {
            color: var(--color-primary);
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            color: var(--color-text);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 0.8rem;
            background: var(--color-background);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            color: var(--color-text);
            font-size: 1rem;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 2px rgba(229, 9, 20, 0.2);
        }

        .btn {
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: #c40711;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
        }

        .search-results {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 1rem;
        }

        .search-item {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            background: var(--color-background);
            border-radius: 8px;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .search-item:hover {
            background: var(--color-surface);
            border-color: var(--color-primary);
        }

        .search-item.selected {
            background: var(--color-primary);
            border-color: var(--color-primary);
        }

        .search-item.selected h4,
        .search-item.selected p {
            color: white;
        }

        .search-item img {
            width: 60px;
            height: 90px;
            object-fit: cover;
            border-radius: 4px;
        }

        .search-item-info h4 {
            color: var(--color-text);
            margin: 0 0 0.5rem 0;
        }

        .search-item-info p {
            color: var(--color-text-muted);
            margin: 0;
            font-size: 0.9rem;
        }

        .generated-code {
            background: var(--color-background);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .generated-code pre {
            color: var(--color-text);
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.4;
            margin: 0;
            white-space: pre-wrap;
        }

        .copy-btn {
            margin-top: 1rem;
            background: var(--color-accent);
        }

        .drag-drop-area {
            border: 2px dashed var(--color-border);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            color: var(--color-text-muted);
            transition: all 0.3s ease;
            cursor: pointer;
            background: var(--color-background);
        }

        .drag-drop-area.dragover {
            border-color: var(--color-primary);
            background: rgba(229, 9, 20, 0.1);
            color: var(--color-primary);
        }

        .drag-drop-area:hover {
            border-color: var(--color-primary);
            background: rgba(229, 9, 20, 0.05);
        }

        .success-message {
            background: #28a745;
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .error-message {
            background: #dc3545;
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .manager-grid {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            
            .content-manager {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="index.html" class="logo">
                <img src="assets/logo.svg" alt="CinemaVault" class="logo-image">
                <span class="text-logo">CinemaVault</span>
            </a>
            <div class="nav-menu">
                <a href="index.html"><i class="fas fa-home"></i> Home</a>
                <a href="#" class="active"><i class="fas fa-cog"></i> Content Manager</a>
            </div>
        </div>
    </nav>

    <main class="content-manager">
        <div class="manager-header">
            <h1><i class="fas fa-tools"></i> CinemaVault Content Manager</h1>
            <p>Easily add new movies, shows, and content to your website</p>
        </div>

        <div class="manager-grid">
            <!-- Movie/Show Search Section -->
            <div class="manager-section">
                <h2 class="section-title">
                    <i class="fas fa-search"></i>
                    Search & Add Content
                </h2>
                
                <div class="form-group">
                    <label for="omdb-search">Search Movies/Shows (OMDB)</label>
                    <input type="text" id="omdb-search" class="form-control" placeholder="Enter movie or show title...">
                </div>

                <div class="form-group">
                    <button type="button" id="search-btn" class="btn">
                        <i class="fas fa-search"></i> Search
                    </button>
                </div>

                <div id="search-results" class="search-results"></div>
            </div>

            <!-- Content Details Section -->
            <div class="manager-section">
                <h2 class="section-title">
                    <i class="fas fa-edit"></i>
                    Content Details
                </h2>

                <div class="form-group">
                    <label for="content-type">Content Type</label>
                    <select id="content-type" class="form-control">
                        <option value="movie">Movie</option>
                        <option value="drama">Drama/Series</option>
                        <option value="anime">Anime</option>
                        <option value="software">Software</option>
                        <option value="game">Game</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="subcategory">Subcategory</label>
                    <select id="subcategory" class="form-control">
                        <!-- Options will be populated dynamically based on content type -->
                    </select>
                </div>

                <div class="form-group">
                    <label for="google-drive">Google Drive Link/ID</label>
                    <input type="text" id="google-drive" class="form-control" placeholder="Paste Google Drive URL or enter file ID">
                    <small>You can drag and drop a Drive link here</small>
                </div>

                <div class="form-group">
                    <button type="button" id="generate-btn" class="btn">
                        <i class="fas fa-code"></i> Generate Code
                    </button>
                </div>
            </div>
        </div>

        <!-- Generated Code Section -->
        <div class="manager-section">
            <h2 class="section-title">
                <i class="fas fa-code"></i>
                Generated Code
            </h2>
            <p>Copy this code and add it to your <code>js/videos.js</code> file:</p>
            
            <div id="generated-code" class="generated-code" style="display: none;">
                <pre id="code-output"></pre>
                <button type="button" id="copy-btn" class="btn copy-btn">
                    <i class="fas fa-copy"></i> Copy Code
                </button>
            </div>
        </div>

        <!-- Drag and Drop Area -->
        <div class="manager-section">
            <h2 class="section-title">
                <i class="fas fa-cloud-upload-alt"></i>
                Quick Add
            </h2>
            <div id="drag-drop-area" class="drag-drop-area">
                <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                <p><strong>Quick Add</strong></p>
                <p>Drag and drop Google Drive links here</p>
                <p>Or click to paste from clipboard</p>
                <p><small>Supports: drive.google.com links, movie titles for search</small></p>
            </div>
        </div>
    </main>

    <script src="js/content-manager.js"></script>
    <script>
        // Check admin authentication first
        function checkAdminAuth() {
            const isAdminLoggedIn = localStorage.getItem('cinemavault-admin') === 'true';
            const adminLoginTime = localStorage.getItem('cinemavault-admin-time');
            const currentTime = Date.now();
            const sessionDuration = 24 * 60 * 60 * 1000; // 24 hours
            
            // Check if session is valid
            if (!isAdminLoggedIn || !adminLoginTime || (currentTime - parseInt(adminLoginTime)) > sessionDuration) {
                // Redirect to login page
                alert('Please login as admin to access this page.');
                window.location.href = 'admin-login.html';
                return false;
            }
            
            return true;
        }
        
        function hasPermission(permission) {
            const permissions = JSON.parse(localStorage.getItem('cinemavault-admin-permissions') || '[]');
            return permissions.includes(permission) || permissions.includes('full_access');
        }
        
        function getAdminRole() {
            return localStorage.getItem('cinemavault-admin-role') || 'content-manager';
        }
        
        function initializeUIBasedOnRole() {
            const role = getAdminRole();
            const adminUser = localStorage.getItem('cinemavault-admin-user') || 'Admin';
            
            // Role-specific welcome messages and UI modifications
            let welcomeMessage = '';
            let uiModifications = [];
            
            switch(role) {
                case 'admin':
                    welcomeMessage = `
                        <i class="fas fa-crown"></i>
                        Welcome back, ${adminUser}! (Full Administrator)
                        <span style="margin-left: 1rem; font-size: 0.9rem;">
                            <i class="fas fa-shield-alt"></i> Full Access Granted
                        </span>
                    `;
                    uiModifications = ['show_advanced_options', 'show_bulk_operations', 'show_system_settings'];
                    break;
                    
                case 'moderator':
                    welcomeMessage = `
                        <i class="fas fa-user-shield"></i>
                        Welcome back, ${adminUser}! (Content Moderator)
                        <span style="margin-left: 1rem; font-size: 0.9rem;">
                            <i class="fas fa-edit"></i> Content Moderation Access
                        </span>
                    `;
                    uiModifications = ['show_moderation_tools', 'limit_deletion'];
                    break;
                    
                case 'content-manager':
                    welcomeMessage = `
                        <i class="fas fa-plus-circle"></i>
                        Welcome back, ${adminUser}! (Content Manager)
                        <span style="margin-left: 1rem; font-size: 0.9rem;">
                            <i class="fas fa-video"></i> Content Creation Access
                        </span>
                    `;
                    uiModifications = ['hide_advanced_options', 'basic_mode_only'];
                    break;
            }
            
            return { welcomeMessage, uiModifications };
        }
        
        // Initialize content manager
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication first
            if (!checkAdminAuth()) {
                return;
            }
            
            console.log('Content Manager Loaded');
            
            // Initialize UI based on admin role
            const { welcomeMessage, uiModifications } = initializeUIBasedOnRole();
            
            // Show welcome message with role-specific content
            const welcomeDiv = document.createElement('div');
            welcomeDiv.className = 'success-message';
            welcomeDiv.innerHTML = `
                ${welcomeMessage}
                <button onclick="logout()" style="float: right; background: none; border: none; color: white; cursor: pointer;">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            `;
            
            const contentManager = document.querySelector('.content-manager');
            contentManager.insertBefore(welcomeDiv, contentManager.firstChild);
            
            // Apply UI modifications based on role
            applyRoleBasedUI(uiModifications);
            
            function applyRoleBasedUI(modifications) {
                const role = getAdminRole();
                
                // Add role-specific features
                if (modifications.includes('show_advanced_options')) {
                    addAdvancedAdminFeatures();
                }
                
                if (modifications.includes('show_moderation_tools')) {
                    addModerationTools();
                }
                
                if (modifications.includes('basic_mode_only')) {
                    enableBasicModeOnly();
                }
                
                // Add role badge to title
                const managerHeader = document.querySelector('.manager-header h1');
                if (managerHeader) {
                    const roleBadge = document.createElement('span');
                    roleBadge.style.cssText = `
                        background: var(--color-primary);
                        color: white;
                        padding: 0.3rem 0.8rem;
                        border-radius: 20px;
                        font-size: 0.7rem;
                        margin-left: 1rem;
                        text-transform: uppercase;
                        font-weight: 600;
                    `;
                    roleBadge.textContent = role.replace('-', ' ');
                    managerHeader.appendChild(roleBadge);
                }
            }
            
            function addAdvancedAdminFeatures() {
                // Add bulk operations section for full admins
                const advancedSection = document.createElement('div');
                advancedSection.className = 'manager-section';
                advancedSection.innerHTML = `
                    <h2 class="section-title">
                        <i class="fas fa-cogs"></i>
                        Advanced Admin Tools
                    </h2>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <button class="btn" onclick="exportDatabase()">
                            <i class="fas fa-download"></i> Export Database
                        </button>
                        <button class="btn" onclick="showAnalytics()">
                            <i class="fas fa-chart-bar"></i> View Analytics
                        </button>
                        <button class="btn btn-secondary" onclick="bulkEdit()">
                            <i class="fas fa-edit"></i> Bulk Edit
                        </button>
                        <button class="btn btn-secondary" onclick="systemSettings()">
                            <i class="fas fa-cog"></i> System Settings
                        </button>
                    </div>
                `;
                
                document.querySelector('.content-manager').appendChild(advancedSection);
            }
            
            function addModerationTools() {
                // Add moderation-specific tools
                const moderationSection = document.createElement('div');
                moderationSection.className = 'manager-section';
                moderationSection.innerHTML = `
                    <h2 class="section-title">
                        <i class="fas fa-shield-alt"></i>
                        Moderation Tools
                    </h2>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <button class="btn" onclick="reviewPending()">
                            <i class="fas fa-clock"></i> Review Pending (0)
                        </button>
                        <button class="btn" onclick="checkBrokenLinks()">
                            <i class="fas fa-link"></i> Check Links
                        </button>
                        <button class="btn btn-secondary" onclick="qualityCheck()">
                            <i class="fas fa-search"></i> Quality Check
                        </button>
                        <button class="btn btn-secondary" onclick="reportedContent()">
                            <i class="fas fa-flag"></i> Reported Content
                        </button>
                    </div>
                `;
                
                document.querySelector('.content-manager').appendChild(moderationSection);
            }
            
            function enableBasicModeOnly() {
                // Simplify UI for content managers
                const managerHeader = document.querySelector('.manager-header p');
                if (managerHeader) {
                    managerHeader.textContent = 'Add new movies and shows to CinemaVault';
                }
                
                // Hide quick add section for basic users
                const quickAddSection = document.querySelector('.manager-section:last-child');
                if (quickAddSection && quickAddSection.querySelector('h2').textContent.includes('Quick Add')) {
                    quickAddSection.style.display = 'none';
                }
            }
            
            // Create manager instance
            const manager = new ContentManager();
            let selectedMovie = null;
            
            // Get DOM elements
            const contentTypeSelect = document.getElementById('content-type');
            const subcategorySelect = document.getElementById('subcategory');
            const searchInput = document.getElementById('omdb-search');
            const searchBtn = document.getElementById('search-btn');
            const searchResults = document.getElementById('search-results');
            const googleDriveInput = document.getElementById('google-drive');
            const generateBtn = document.getElementById('generate-btn');
            const generatedCodeDiv = document.getElementById('generated-code');
            const codeOutput = document.getElementById('code-output');
            const copyBtn = document.getElementById('copy-btn');
            
            // Dynamic subcategory filtering
            const subcategoryOptions = {
                'movie': [
                    { value: 'Hollywood', text: 'Hollywood' },
                    { value: 'Bollywood', text: 'Bollywood' },
                    { value: 'Chinese Movie', text: 'Chinese Movie' },
                    { value: 'Korean Movie', text: 'Korean Movie' },
                    { value: 'Bangla', text: 'Bangla Movie' },
                    { value: 'South Indian', text: 'South Indian' }
                ],
                'drama': [
                    { value: 'Korean Drama', text: 'Korean Drama' },
                    { value: 'Chinese Drama', text: 'Chinese Drama' },
                    { value: 'English Series', text: 'English Series' },
                    { value: 'Thai Drama', text: 'Thai Drama' }
                ],
                'anime': [
                    { value: 'Japanese Anime', text: 'Japanese Anime' },
                    { value: 'Korean Anime', text: 'Korean Anime' },
                    { value: 'Chinese Anime', text: 'Chinese Anime' }
                ],
                'software': [
                    { value: 'Software', text: 'Software' }
                ],
                'game': [
                    { value: 'Game', text: 'Game' }
                ]
            };
            
            function updateSubcategories() {
                const selectedType = contentTypeSelect.value;
                const options = subcategoryOptions[selectedType] || [];
                
                // Clear existing options
                subcategorySelect.innerHTML = '';
                
                // Add new options
                options.forEach(option => {
                    const optionElement = document.createElement('option');
                    optionElement.value = option.value;
                    optionElement.textContent = option.text;
                    subcategorySelect.appendChild(optionElement);
                });
            }
            
            function showMessage(message, type = 'success') {
                const messageDiv = document.createElement('div');
                messageDiv.className = `${type}-message`;
                messageDiv.textContent = message;
                
                // Insert at top of content manager
                const contentManager = document.querySelector('.content-manager');
                contentManager.insertBefore(messageDiv, contentManager.firstChild);
                
                // Remove after 3 seconds
                setTimeout(() => {
                    messageDiv.remove();
                }, 3000);
            }
            
            // OMDB Search functionality
            searchBtn.addEventListener('click', async function() {
                const searchTerm = searchInput.value.trim();
                if (!searchTerm) {
                    showMessage('Please enter a search term', 'error');
                    return;
                }
                
                try {
                    searchBtn.textContent = 'Searching...';
                    searchBtn.disabled = true;
                    
                    const results = await manager.searchByTitle(searchTerm);
                    
                    if (results.length === 0) {
                        searchResults.innerHTML = '<p style="color: var(--color-text-muted); text-align: center; padding: 2rem;">No results found</p>';
                        return;
                    }
                    
                    searchResults.innerHTML = results.map(movie => `
                        <div class="search-item" data-imdb="${movie.imdbID}" onclick="selectMovie('${movie.imdbID}', '${movie.Title.replace(/'/g, "\\'")}', '${movie.Year}', '${movie.Poster}')">
                            <img src="${movie.Poster !== 'N/A' ? movie.Poster : 'https://via.placeholder.com/60x90?text=No+Image'}" 
                                 alt="${movie.Title}" onerror="this.src='https://via.placeholder.com/60x90?text=No+Image'">
                            <div class="search-item-info">
                                <h4>${movie.Title}</h4>
                                <p>Year: ${movie.Year}</p>
                                <p>Type: ${movie.Type}</p>
                                <p>IMDB ID: ${movie.imdbID}</p>
                            </div>
                        </div>
                    `).join('');
                    
                } catch (error) {
                    console.error('Search error:', error);
                    showMessage('Search failed. Please try again.', 'error');
                    searchResults.innerHTML = '<p style="color: var(--color-text-muted); text-align: center; padding: 2rem;">Search failed. Please try again.</p>';
                } finally {
                    searchBtn.textContent = 'Search';
                    searchBtn.disabled = false;
                }
            });
            
            // Make selectMovie global for onclick handlers
            window.selectMovie = function(imdbID, title, year, poster) {
                selectedMovie = { imdbID, Title: title, Year: year, Poster: poster };
                
                // Update UI to show selection
                document.querySelectorAll('.search-item').forEach(item => {
                    item.classList.remove('selected');
                });
                document.querySelector(`[data-imdb="${imdbID}"]`).classList.add('selected');
                
                showMessage(`Selected: ${title} (${year})`);
            };
            
            // Generate code functionality
            generateBtn.addEventListener('click', async function() {
                if (!selectedMovie) {
                    showMessage('Please select a movie from search results first', 'error');
                    return;
                }
                
                const driveInput = googleDriveInput.value.trim();
                if (!driveInput) {
                    showMessage('Please enter a Google Drive link or ID', 'error');
                    return;
                }
                
                const contentType = contentTypeSelect.value;
                const subcategory = subcategorySelect.value;
                
                try {
                    generateBtn.textContent = 'Generating...';
                    generateBtn.disabled = true;
                    
                    // Extract Drive ID
                    const driveId = manager.extractDriveId(driveInput) || driveInput;
                    
                    if (!manager.isValidDriveId(driveId)) {
                        showMessage('Invalid Google Drive ID format', 'error');
                        return;
                    }
                    
                    // Get detailed movie info
                    const movieDetails = await manager.getMovieDetails(selectedMovie.imdbID);
                    if (!movieDetails) {
                        showMessage('Could not fetch movie details', 'error');
                        return;
                    }
                    
                    // Generate template
                    const template = manager.generateVideoTemplate(movieDetails, driveId, contentType, subcategory);
                    
                    // Show generated code
                    codeOutput.textContent = template;
                    generatedCodeDiv.style.display = 'block';
                    
                    showMessage('Code generated successfully!');
                    
                } catch (error) {
                    console.error('Generate error:', error);
                    showMessage('Failed to generate code. Please try again.', 'error');
                } finally {
                    generateBtn.textContent = 'Generate Code';
                    generateBtn.disabled = false;
                }
            });
            
            // Copy to clipboard functionality
            copyBtn.addEventListener('click', function() {
                const code = codeOutput.textContent;
                
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(code).then(function() {
                        showMessage('Code copied to clipboard!');
                        copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                        setTimeout(() => {
                            copyBtn.innerHTML = '<i class="fas fa-copy"></i> Copy Code';
                        }, 2000);
                    });
                } else {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = code;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    
                    showMessage('Code copied to clipboard!');
                    copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                    setTimeout(() => {
                        copyBtn.innerHTML = '<i class="fas fa-copy"></i> Copy Code';
                    }, 2000);
                }
            });
            
            // Enter key search
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchBtn.click();
                }
            });
            
            // Drag and Drop functionality
            const dragDropArea = document.getElementById('drag-drop-area');
            
            function handleDragOver(e) {
                e.preventDefault();
                dragDropArea.classList.add('dragover');
            }
            
            function handleDragLeave(e) {
                e.preventDefault();
                dragDropArea.classList.remove('dragover');
            }
            
            function handleDrop(e) {
                e.preventDefault();
                dragDropArea.classList.remove('dragover');
                
                const data = e.dataTransfer.getData('text');
                if (data) {
                    processDraggedData(data);
                }
            }
            
            function processDraggedData(data) {
                // Check if it's a Google Drive link
                if (data.includes('drive.google.com')) {
                    const driveId = manager.extractDriveId(data);
                    if (driveId) {
                        googleDriveInput.value = driveId;
                        showMessage('Google Drive ID extracted successfully!');
                    } else {
                        showMessage('Could not extract Drive ID from the link', 'error');
                    }
                } else {
                    // Assume it's a movie title for search
                    searchInput.value = data.trim();
                    showMessage('Text added to search field');
                }
            }
            
            // Add drag and drop event listeners
            dragDropArea.addEventListener('dragover', handleDragOver);
            dragDropArea.addEventListener('dragleave', handleDragLeave);
            dragDropArea.addEventListener('drop', handleDrop);
            
            // Also handle paste events in the drag drop area
            dragDropArea.addEventListener('click', function() {
                navigator.clipboard.readText().then(text => {
                    if (text.trim()) {
                        processDraggedData(text);
                    }
                }).catch(err => {
                    // Fallback: prompt user to paste
                    const userInput = prompt('Paste your Google Drive link or movie title here:');
                    if (userInput) {
                        processDraggedData(userInput);
                    }
                });
            });
            
            // Handle paste events in Google Drive input
            googleDriveInput.addEventListener('paste', function(e) {
                setTimeout(() => {
                    const pastedText = e.target.value;
                    const driveId = manager.extractDriveId(pastedText);
                    if (driveId && driveId !== pastedText) {
                        e.target.value = driveId;
                        showMessage('Drive ID extracted from URL');
                    }
                }, 100);
            });
            
            // Initialize subcategories
            updateSubcategories();
            
            // Update subcategories when content type changes
            contentTypeSelect.addEventListener('change', updateSubcategories);
        });
        
        // Logout function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('cinemavault-admin');
                localStorage.removeItem('cinemavault-admin-user');
                localStorage.removeItem('cinemavault-admin-role');
                localStorage.removeItem('cinemavault-admin-permissions');
                localStorage.removeItem('cinemavault-admin-time');
                window.location.href = 'index.html';
            }
        }
        
        // Advanced Admin Functions
        function exportDatabase() {
            if (!hasPermission('backup')) {
                alert('You do not have permission to export the database.');
                return;
            }
            
            fetch('js/videos.js')
                .then(response => response.text())
                .then(data => {
                    const blob = new Blob([data], { type: 'application/javascript' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `cinemavault-backup-${new Date().toISOString().split('T')[0]}.js`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    showMessage('Database exported successfully!');
                })
                .catch(err => {
                    showMessage('Failed to export database', 'error');
                });
        }
        
        function showAnalytics() {
            if (!hasPermission('analytics')) {
                alert('You do not have permission to view analytics.');
                return;
            }
            
            alert('Analytics Dashboard\n\n' +
                  'ðŸ“Š Total Content: Loading...\n' +
                  'ðŸŽ¬ Movies: Loading...\n' +
                  'ðŸ“º Series: Loading...\n' +
                  'ðŸŽŒ Anime: Loading...\n' +
                  'ðŸ’» Software: Loading...\n' +
                  'ðŸŽ® Games: Loading...\n\n' +
                  'Full analytics dashboard coming soon!');
        }
        
        function bulkEdit() {
            if (!hasPermission('content_crud')) {
                alert('You do not have permission for bulk operations.');
                return;
            }
            
            alert('Bulk Edit Tools\n\n' +
                  'â€¢ Update multiple entries\n' +
                  'â€¢ Fix broken Drive links\n' +
                  'â€¢ Batch category changes\n' +
                  'â€¢ Mass metadata updates\n\n' +
                  'Feature in development!');
        }
        
        function systemSettings() {
            if (!hasPermission('system_settings')) {
                alert('You do not have permission to access system settings.');
                return;
            }
            
            alert('System Settings\n\n' +
                  'âš™ï¸ API Configuration\n' +
                  'ðŸ”§ Cache Management\n' +
                  'ðŸ‘¥ User Management\n' +
                  'ðŸ›¡ï¸ Security Settings\n\n' +
                  'Advanced settings panel coming soon!');
        }
        
        // Moderation Functions
        function reviewPending() {
            if (!hasPermission('content_moderate')) {
                alert('You do not have permission for content moderation.');
                return;
            }
            
            alert('Pending Content Review\n\n' +
                  'No pending submissions at this time.\n\n' +
                  'This feature will show:\n' +
                  'â€¢ User submitted content\n' +
                  'â€¢ Flagged entries\n' +
                  'â€¢ Quality issues');
        }
        
        function checkBrokenLinks() {
            if (!hasPermission('quality_control')) {
                alert('You do not have permission for quality control.');
                return;
            }
            
            showMessage('Checking for broken links... This may take a moment.');
            
            // Simulate link checking
            setTimeout(() => {
                alert('Link Check Results\n\n' +
                      'âœ… Working Links: 95%\n' +
                      'âš ï¸ Suspicious Links: 3%\n' +
                      'âŒ Broken Links: 2%\n\n' +
                      'Detailed report will be available in full version.');
            }, 2000);
        }
        
        function qualityCheck() {
            alert('Quality Control Dashboard\n\n' +
                  'ðŸ” Duplicate Detection\n' +
                  'ðŸ“ Metadata Validation\n' +
                  'ðŸ–¼ï¸ Missing Posters\n' +
                  'â­ Rating Inconsistencies\n\n' +
                  'Quality tools coming soon!');
        }
        
        function reportedContent() {
            alert('Reported Content\n\n' +
                  'No reports at this time.\n\n' +
                  'This will show:\n' +
                  'â€¢ User reports\n' +
                  'â€¢ Copyright claims\n' +
                  'â€¢ Quality issues\n' +
                  'â€¢ Inappropriate content');
        }
        
        function showMessage(message, type = 'success') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `${type}-message`;
            messageDiv.textContent = message;
            
            const contentManager = document.querySelector('.content-manager');
            contentManager.insertBefore(messageDiv, contentManager.firstChild);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }
    </script>
</body>
</html>
